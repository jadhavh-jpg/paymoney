<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PayMoney â€“ Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<!-- QR -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:#f1f5f9}
.wrap{max-width:1100px;margin:20px auto;padding:12px}
.flex{display:flex;gap:16px}
@media(max-width:900px){.flex{flex-direction:column}}
.card{background:#fff;border-radius:20px;padding:16px;box-shadow:0 15px 35px rgba(0,0,0,.12)}
.left,.right{width:50%}
@media(max-width:900px){.left,.right{width:100%}}

label{font-weight:600;margin-top:10px;display:block}
input,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid #ccc;margin-top:6px}
textarea{min-height:80px}

button{
  width:100%;padding:14px;border:none;border-radius:999px;
  font-weight:700;margin-top:12px;cursor:pointer
}
.gen{background:#0f172a;color:#fff}
.copy{background:#334155;color:#fff}
.wa{background:#22c55e;color:#fff}

/* preview */
.header{display:flex;justify-content:space-between;align-items:center}
.logo{width:60px;height:60px;border-radius:12px;background:#e5e7eb;overflow:hidden}
.logo img{width:100%;height:100%;object-fit:contain}
.reg{background:#22c55e;color:#fff;padding:10px 18px;border-radius:999px;text-decoration:none}

.poster{aspect-ratio:2/3;background:#e5e7eb;border-radius:16px;overflow:hidden;margin-top:10px}
.poster img{width:100%;height:100%;object-fit:cover}

.brand{font-weight:800;margin-top:10px}
.desc{font-size:14px;color:#334155}

/* landing */
.lwrap{max-width:420px;margin:20px auto}
.pay{background:#22c55e;color:#fff}
.qr{background:#1e40af;color:#fff}
.qrbox{text-align:center;margin-top:12px}
</style>
</head>

<body>

<div id="app"></div>

<script>
/* ================= FIREBASE CONFIG ================= */
firebase.initializeApp({
  apiKey: "AIzaSyCpfisfbj1R63LQsOdF9iCWMLCUwnMQMGA",
  authDomain: "paymoney24-cd9ad.firebaseapp.com",
  projectId: "paymoney24-cd9ad",
  storageBucket: "paymoney24-cd9ad.appspot.com"
});
const storage = firebase.storage();

/* ================= ROUTING ================= */
const q=new URLSearchParams(location.search);
if(q.get("i")){
  loadLanding(q.get("i"));
}else{
  loadBuilder();
}

/* ================= BUILDER ================= */
function loadBuilder(){
document.getElementById("app").innerHTML=`
<div class="wrap">
  <div class="flex">
    <div class="card left">
      <h2>Create Payment Page</h2>

      <label>Logo</label>
      <input type="file" id="logoF">

      <label>Poster *</label>
      <input type="file" id="posterF">

      <label>Title</label>
      <input id="title" placeholder="3-Day Yoga Class">

      <label>Description</label>
      <textarea id="desc"></textarea>

      <label>UPI ID *</label>
      <input id="upi" placeholder="jadhav.h3@ybl">

      <label>Amount *</label>
      <input id="amt" type="number">

      <button class="gen" onclick="generate()">Generate Link</button>
      <button class="copy" onclick="copy()">ðŸ“‹ Copy Link</button>
      <button class="wa" onclick="share()">ðŸ“¤ WhatsApp</button>
    </div>

    <div class="card right">
      <div class="header">
        <div class="logo" id="pLogo"></div>
        <a class="reg" id="pBtn">Register Now</a>
      </div>
      <div class="poster" id="pPoster"></div>
      <div class="brand" id="pTitle">Live Preview</div>
      <div class="desc" id="pDesc"></div>
    </div>
  </div>
</div>`;
bindBuilder();
}

let data={};

function bindBuilder(){
title.oninput=()=>pTitle.innerText=title.value;
desc.oninput=()=>pDesc.innerText=desc.value;

logoF.onchange=e=>upload(e.target.files[0],url=>{
  data.logo=url;
  pLogo.innerHTML=`<img src="${url}">`;
});

posterF.onchange=e=>upload(e.target.files[0],url=>{
  data.poster=url;
  pPoster.innerHTML=`<img src="${url}">`;
});
}

function upload(file,cb){
  const ref=storage.ref("landing/"+Date.now()+"_"+file.name);
  ref.put(file).then(()=>ref.getDownloadURL()).then(cb);
}

function generate(){
  if(!data.poster||!upi.value||!amt.value){
    alert("Poster, UPI & Amount required");
    return;
  }
  const id=Date.now().toString(36); // ðŸ”— SHORT ID
  data.title=title.value;
  data.desc=desc.value;
  data.upi=upi.value;
  data.amt=amt.value;

  localStorage.setItem("pm_"+id,JSON.stringify(data));
  const link=location.origin+location.pathname+"?i="+id;
  window.shortLink=link;
  pBtn.href=link;
  alert("Short link generated");
}

function copy(){navigator.clipboard.writeText(window.shortLink||"")}
function share(){window.open("https://wa.me/?text="+encodeURIComponent(window.shortLink||""))}

/* ================= LANDING ================= */
function loadLanding(id){
const d=JSON.parse(localStorage.getItem("pm_"+id));
if(!d){document.body.innerHTML="Invalid link";return;}

const upi=`upi://pay?pa=${encodeURIComponent(d.upi)}&pn=${encodeURIComponent(d.title)}&am=${d.amt}&cu=INR`;

document.getElementById("app").innerHTML=`
<div class="lwrap">
  <div class="card">
    ${d.logo?`<div class="logo"><img src="${d.logo}"></div>`:""}
    <div class="poster"><img src="${d.poster}"></div>
    <h3>${d.title}</h3>
    <p>${d.desc||""}</p>

    <button class="pay" onclick="openUPI()">ðŸ“± Pay via UPI</button>
    <button class="qr" onclick="showQR()">ðŸ’» Scan QR</button>
    <div class="qrbox" id="qr"></div>
  </div>
</div>`;

window.openUPI=()=>{
  location.href=upi;
  setTimeout(showQR,1200);
};
window.showQR=()=>{
  QRCode.toCanvas(document.createElement("canvas"),upi,{width:220},(e,c)=>{
    const q=document.getElementById("qr");
    q.innerHTML="";q.appendChild(c);
  });
};
}
</script>

</body>
</html>
