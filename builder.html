<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PayMoney – Landing Builder</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial,sans-serif;background:#f5f7fb}
.wrap{max-width:1100px;margin:20px auto;padding:0 14px}
.flex{display:flex;gap:20px;align-items:flex-start}
.box{background:#fff;border-radius:16px;padding:20px;width:50%}
h2,h3{margin-top:0}
label{font-weight:600;margin-top:14px;display:block}
input,textarea{width:100%;padding:12px;border-radius:8px;border:1px solid #ccc;margin-top:6px;font-size:15px}
textarea{min-height:90px}
button{width:100%;padding:14px;border:none;border-radius:14px;font-size:16px;font-weight:600;cursor:pointer;margin-top:16px}
.primary{background:#0D3B66;color:#fff}
.copy{background:#2FB344;color:#fff}
.wa{background:#25D366;color:#fff}
.anim{position:relative;overflow:hidden}
.anim::after{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(120deg,transparent,rgba(255,255,255,.35),transparent);animation:shine 2.8s infinite}
@keyframes shine{0%{left:-100%}100%{left:100%}}
.preview{border:1px solid #ddd;border-radius:16px;overflow:hidden}
.poster{aspect-ratio:2/3;background:#eee}
.poster img{width:100%;height:100%;object-fit:cover}
.c{padding:16px;text-align:center}
.brand-btn{background:#0D3B66;color:#fff;margin-top:8px}
.title-btn{background:#1f6fd6;color:#fff;margin-top:8px}
.date-line{margin-top:10px;font-size:14px;color:#555;display:flex;justify-content:center;align-items:center;gap:8px}
.pay{margin-top:14px;padding:14px;border-radius:14px;background:#2FB344;color:#fff;text-align:center}
.disabled{opacity:.35;pointer-events:none}
.actions{margin-top:14px;display:none}
@media(max-width:900px){.flex{flex-direction:column}.box{width:100%}}

.qr-modal{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center;z-index:999
}
.qr-box{background:#fff;padding:20px;border-radius:16px;text-align:center;width:300px}
.qr-box canvas{margin:10px auto}
.close{margin-top:10px;background:#0D3B66;color:#fff}
.small-note{font-size:13px;color:#555;margin-top:8px}
.app-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.app-row .pay{flex:1;min-width:140px}
.gpay{background:#111}
.phonepe{background:#5b2aa8}
.paytm{background:#00b9f1}
</style>
</head>

<body>

<div class="wrap" id="builder">
<div class="flex">

<!-- LEFT -->
<div class="box">
<h2>Create Landing</h2>

<label>Brand</label>
<input id="brand" oninput="sync()">

<label>Poster Image (Required)</label>
<input type="file" accept="image/*" onchange="loadImg(event)">

<label>Title</label>
<input id="title" oninput="sync()">

<label>Date & Time</label>
<input type="datetime-local" id="dt" oninput="sync()">

<label>UPI ID</label>
<input id="upi" placeholder="example@upi">

<label>Amount (INR)</label>
<input id="amount" type="number">

<label>Description</label>
<textarea id="desc" oninput="sync()"></textarea>

<button class="primary anim" onclick="generate()">Generate Landing Page</button>

<div class="actions" id="actions">
  <button class="copy anim" onclick="copyLink()">Copy Landing Link</button>
  <button class="wa anim" onclick="shareWA()">Share on WhatsApp</button>
</div>
</div>

<!-- RIGHT -->
<div class="box">
<h3>Live Preview</h3>
<div class="preview">
  <div class="poster" id="pimg"></div>
  <div class="c">
    <button class="brand-btn anim" id="pBrandBtn">Brand</button>
    <button class="title-btn anim" id="pTitleBtn">Title</button>
    <div class="date-line"><i class="fa-solid fa-calendar-days"></i><span id="pdt"></span></div>
    <p id="pdesc"></p>
    <div class="pay disabled">Pay Now</div>
  </div>
</div>
</div>

</div>
</div>

<!-- QR MODAL -->
<div class="qr-modal" id="qrModal">
  <div class="qr-box">
    <h3>Scan to Pay</h3>
    <canvas id="qr"></canvas>
    <p class="small-note">Desktop users: Scan QR using your mobile UPI app</p>
    <button class="close" onclick="closeQR()">Close</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
let imageURL="", landingLink="", currentUpiLink="";

function loadImg(e){
  imageURL=URL.createObjectURL(e.target.files[0]);
  pimg.innerHTML=`<img src="${imageURL}">`;
}
function sync(){
  pBrandBtn.innerText=brand.value||"Brand";
  pTitleBtn.innerText=title.value||"Title";
  pdt.innerText=dt.value;
  pdesc.innerText=desc.value;
}

function generate(){
  if(!imageURL||!upi.value||!amount.value){
    alert("Image, UPI & Amount required");
    return;
  }
  const upiLink=`upi://pay?pa=${encodeURIComponent(upi.value)}&am=${amount.value}&cu=INR&tn=PayMoney`;
  const id=Date.now();
  localStorage.setItem("landing_"+id,JSON.stringify({
    brand:brand.value,title:title.value,dt:dt.value,
    desc:desc.value,img:imageURL,upiLink
  }));
  landingLink=location.origin+location.pathname+"?view=landing&id="+id;
  actions.style.display="block";
}
function copyLink(){navigator.clipboard.writeText(landingLink);alert("Link copied")}
function shareWA(){window.open("https://wa.me/?text="+encodeURIComponent(landingLink))}

/* ===== LANDING MODE ===== */
const q=new URLSearchParams(location.search);
if(q.get("view")==="landing"){
  const d=JSON.parse(localStorage.getItem("landing_"+q.get("id")));
  if(!d){ document.body.innerHTML="Invalid Link"; }
  else{
    currentUpiLink = d.upiLink;
    document.getElementById("builder").innerHTML=`
      <div class="box">
        <img src="${d.img}" style="width:100%;border-radius:16px">
        <button class="brand-btn anim">${d.brand}</button>
        <button class="title-btn anim">${d.title}</button>
        <div class="date-line">${d.dt}</div>
        <p>${d.desc}</p>

        <div class="pay anim" onclick="pay(currentUpiLink)">Pay Now</div>

        <div class="app-row">
          <button class="pay gpay anim" onclick="payGpay()">Google Pay</button>
          <button class="pay phonepe anim" onclick="payPhonePe()">PhonePe</button>
          <button class="pay paytm anim" onclick="payPaytm()">Paytm</button>
        </div>

        <div class="small-note">If payment doesn’t open, try another UPI app.</div>
      </div>`;
  }
}

/* ===== FINAL WORKING DEEP-LINK LOGIC ===== */
function openLink(url){
  const a=document.createElement("a");
  a.href=url; a.style.display="none";
  document.body.appendChild(a); a.click(); a.remove();
}
function makeIntent(upiLink, pkg){
  return upiLink.replace("upi://pay?","intent://pay?")
    + `#Intent;scheme=upi;${pkg?`package=${pkg};`:``}end`;
}
function pay(upiLink){
  const ua=navigator.userAgent;
  const isAndroid=/Android/i.test(ua);
  const isIOS=/iPhone|iPad|iPod/i.test(ua);

  if(isIOS){ openLink(upiLink); return; }

  if(isAndroid){
    openLink(makeIntent(upiLink));     // generic chooser
    setTimeout(()=>openLink(upiLink),600); // fallback
    return;
  }

  QRCode.toCanvas(document.getElementById("qr"),upiLink);
  document.getElementById("qrModal").style.display="flex";
}
function payGpay(){ openLink(makeIntent(currentUpiLink,"com.google.android.apps.nbu.paisa.user")); }
function payPhonePe(){ openLink(makeIntent(currentUpiLink,"com.phonepe.app")); }
function payPaytm(){ openLink(makeIntent(currentUpiLink,"net.one97.paytm")); }

function closeQR(){ document.getElementById("qrModal").style.display="none"; }
</script>

</body>
</html>
