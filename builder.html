<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PayMoney Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:#f1f5f9}

/* Header */
header{
  position:sticky;top:0;z-index:10;
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 20px;background:#fff;border-bottom:1px solid #e5e7eb
}
header h2{margin:0;font-size:18px}
header button{
  background:#22c55e;color:#fff;border:none;
  padding:10px 18px;border-radius:999px;font-weight:700;cursor:pointer
}

/* Layout */
.wrapper{display:flex;gap:20px;padding:20px}
.form,.preview{
  flex:1;background:#fff;border-radius:20px;
  padding:20px;box-shadow:0 20px 40px rgba(0,0,0,.12)
}
@media(max-width:900px){.wrapper{flex-direction:column}}

/* Inputs */
label{font-size:13px;font-weight:600}
input,textarea{
  width:100%;padding:10px;margin:6px 0 14px;
  border-radius:8px;border:1px solid #cbd5e1
}
.radio{display:flex;gap:16px;margin-bottom:14px}
.primary{
  width:100%;padding:14px;border:none;border-radius:999px;
  background:#0ea5e9;color:#fff;font-weight:800;cursor:pointer
}
.disabled{opacity:.5;pointer-events:none}

/* Preview Card */
.card{
  max-width:420px;margin:auto;background:#fff;padding:18px;
  border-radius:22px;box-shadow:0 20px 40px rgba(0,0,0,.15)
}
.card img{width:100%;border-radius:16px;display:none;margin-bottom:10px}
.badge{
  display:inline-block;padding:4px 10px;border-radius:999px;
  background:#dcfce7;color:#166534;font-size:12px;font-weight:700
}
.amount{font-size:22px;font-weight:900;margin:10px 0}
</style>
</head>

<body>

<header>
  <h2>PayMoney Builder</h2>
  <button>Register Now</button>
</header>

<div class="wrapper">

<!-- LEFT : FORM -->
<div class="form">
  <h3>Create Payment Page</h3>

  <label>Title *</label>
  <input id="title">

  <label>Sub Title</label>
  <input id="subtitle">

  <label>Description</label>
  <textarea id="desc"></textarea>

  <label>Date</label>
  <input type="date" id="date">

  <label>Time</label>
  <input type="time" id="time">

  <label>Mode</label>
  <div class="radio">
    <label><input type="radio" name="mode" value="Online" checked> Online</label>
    <label><input type="radio" name="mode" value="Offline"> Offline</label>
  </div>

  <label>Amount (â‚¹) *</label>
  <input type="number" id="amount">

  <label>UPI ID *</label>
  <input id="upi">

  <label>WhatsApp Group Link (optional)</label>
  <input id="waGroup" placeholder="https://chat.whatsapp.com/...">

  <label>Upload Logo / Poster *</label>
  <input type="file" id="image">

  <button class="primary" onclick="generate()">Generate & Open Page</button>
</div>

<!-- RIGHT : LIVE PREVIEW -->
<div class="preview">
  <h3>Live Preview</h3>

  <div class="card">
    <img id="pImg">
    <span class="badge" id="pMode">Online</span>
    <h3 id="pTitle">Title</h3>
    <p id="pSub"></p>
    <p id="pDesc"></p>
    <p id="pDT"></p>
    <div class="amount" id="pAmount">â‚¹0</div>

    <button class="primary disabled">Open UPI App</button>

    <!-- âœ… WhatsApp Group Preview Button -->
    <button
      id="pGroupBtn"
      class="primary disabled"
      style="background:#25D366;margin-top:8px">
      Access WhatsApp Group
    </button>
  </div>
</div>

</div>

<script>
// ðŸ”´ Cloudinary config (FILLED)
const CLOUD_NAME = "ddusj34vn";
const UPLOAD_PRESET = "paymoney_unsigned";

let imageURL = "";

// Inputs
const title = document.getElementById("title");
const subtitle = document.getElementById("subtitle");
const desc = document.getElementById("desc");
const date = document.getElementById("date");
const time = document.getElementById("time");
const amount = document.getElementById("amount");
const upi = document.getElementById("upi");
const waGroupInput = document.getElementById("waGroup");

// Preview elements
const pTitle = document.getElementById("pTitle");
const pSub = document.getElementById("pSub");
const pDesc = document.getElementById("pDesc");
const pDT = document.getElementById("pDT");
const pAmount = document.getElementById("pAmount");
const pMode = document.getElementById("pMode");
const pImg = document.getElementById("pImg");
const pGroupBtn = document.getElementById("pGroupBtn");

// Live preview binding
[title, subtitle, desc, date, time, amount, waGroupInput].forEach(el=>{
  el.oninput = updatePreview;
});
document.querySelectorAll("input[name=mode]").forEach(r=>{
  r.onchange = updatePreview;
});

// Image upload
document.getElementById("image").onchange = async e=>{
  const file = e.target.files[0];
  if(!file) return;
  imageURL = await uploadImage(file);
  updatePreview();
};

function updatePreview(){
  pTitle.innerText = title.value || "Title";
  pSub.innerText = subtitle.value || "";
  pDesc.innerText = desc.value || "";
  pAmount.innerText = "â‚¹ " + (amount.value || 0);
  pMode.innerText =
    document.querySelector("input[name=mode]:checked").value;
  pDT.innerText = (date.value || "") + " " + (time.value || "");

  if(imageURL){
    pImg.src = imageURL;
    pImg.style.display = "block";
  }

  // âœ… WhatsApp Group button enable / disable
  if(waGroupInput.value.trim()){
    pGroupBtn.classList.remove("disabled");
  } else {
    pGroupBtn.classList.add("disabled");
  }
}

// Cloudinary upload
async function uploadImage(file){
  const fd = new FormData();
  fd.append("file", file);
  fd.append("upload_preset", UPLOAD_PRESET);

  const res = await fetch(
    `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
    { method:"POST", body:fd }
  );
  const data = await res.json();
  return data.secure_url;
}

// Generate landing page
function generate(){
  if(!title.value || !amount.value || !upi.value || !imageURL){
    alert("Title, Amount, UPI & Image required");
    return;
  }

  const mode =
    document.querySelector("input[name=mode]:checked").value;

  let link =
    "/landing.html"+
    "?title="+encodeURIComponent(title.value)+
    "&subtitle="+encodeURIComponent(subtitle.value)+
    "&desc="+encodeURIComponent(desc.value)+
    "&date="+date.value+
    "&time="+time.value+
    "&mode="+mode+
    "&amount="+amount.value+
    "&upi="+encodeURIComponent(upi.value)+
    "&img="+encodeURIComponent(imageURL);

  if(waGroupInput.value.trim()){
    link += "&group=" + encodeURIComponent(waGroupInput.value.trim());
  }

  window.open(link,"_blank");
}
  function makeId(){
  return Math.random().toString(36).slice(2,8);
}

const shortId = makeId();

const payload = {
  [shortId]: {
    title: title.value,
    subtitle: subtitle.value,
    desc: desc.value,
    date: date.value,
    time: time.value,
    mode: mode,
    amount: amount.value,
    upi: upi.value,
    img: imageURL,
    group: waGroupInput.value || ""
  }
};

console.log("ADD THIS TO links.json:", payload);

alert(
  "Short link created!\n\n" +
  "Now add this data to data/links.json\n\n" +
  "Short link:\n" +
  location.origin + "/p.html?id=" + shortId
);

window.open("/p.html?id=" + shortId, "_blank");

</script>

</body>
</html>
