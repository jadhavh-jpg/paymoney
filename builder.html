<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PayMoney â€“ Builder & Landing</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<!-- QR -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#f1f5f9}
.wrap{max-width:420px;margin:20px auto;padding:14px}
.card{
  background:#fff;border-radius:22px;padding:18px;
  box-shadow:0 20px 40px rgba(0,0,0,.15)
}
h2{text-align:center;margin:0 0 12px}
input,textarea{
  width:100%;padding:12px;margin-top:10px;
  border-radius:10px;border:1px solid #cbd5e1
}
textarea{min-height:80px}
button{
  width:100%;padding:14px;margin-top:12px;
  border:none;border-radius:14px;
  font-size:16px;font-weight:700;cursor:pointer
}
.primary{background:#2563eb;color:#fff}
.copy{background:#0f172a;color:#fff}
.wa{background:#22c55e;color:#fff}
.pay{background:#22c55e;color:#fff}
.qrbtn{background:#1e40af;color:#fff}

.poster{
  width:100%;aspect-ratio:2/3;
  background:#e5e7eb;border-radius:16px;
  overflow:hidden;margin-top:12px
}
.poster img{width:100%;height:100%;object-fit:cover}

.qr-box{display:none;text-align:center;margin-top:14px}
.note{text-align:center;font-size:13px;color:#64748b;margin-top:10px}
.footer{text-align:center;font-size:12px;color:#94a3b8;margin-top:14px}
</style>
</head>

<body>

<div class="wrap" id="app"></div>

<script>
/* ðŸ”¥ FIREBASE CONFIG (APNA DALO) */
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com"
});
const storage = firebase.storage();

/* CHECK MODE */
const q = new URLSearchParams(location.search);
const landingId = q.get("id");

let posterURL="";

/* ================= BUILDER MODE ================= */
if(!landingId){
  app.innerHTML = `
    <div class="card">
      <h2>Create Payment Page</h2>

      <input id="title" placeholder="Title (Yoga Class)">
      <textarea id="desc" placeholder="Description"></textarea>
      <input id="upi" placeholder="UPI ID (jadhav.h3@ybl)">
      <input id="amount" type="number" placeholder="Amount (INR)">

      <input type="file" accept="image/*" id="img">

      <button class="primary" onclick="uploadAndGenerate()">Generate Link</button>

      <input id="linkBox" readonly style="display:none">
      <button class="copy" style="display:none" onclick="copyLink()">ðŸ“‹ Copy Link</button>
      <button class="wa" style="display:none" onclick="shareWA()">ðŸ“¤ Share WhatsApp</button>

      <div class="note">Image Firebase Storage me upload hogi</div>
    </div>
  `;
}

/* IMAGE UPLOAD + GENERATE */
function uploadAndGenerate(){
  const file=document.getElementById("img").files[0];
  if(!file||!upi.value||!amount.value){
    alert("Image, UPI & Amount required");
    return;
  }
  const ref=storage.ref("posters/"+Date.now()+"_"+file.name);
  ref.put(file).then(()=>ref.getDownloadURL().then(url=>{
    posterURL=url;
    generate();
  }));
}

function generate(){
  const id=Date.now();
  localStorage.setItem("pm_"+id,JSON.stringify({
    title:title.value,
    desc:desc.value,
    poster:posterURL,
    upi:upi.value,
    amount:amount.value
  }));
  const link=location.origin+location.pathname+"?id="+id;
  linkBox.value=link;
  linkBox.style.display="block";
  document.querySelector(".copy").style.display="block";
  document.querySelector(".wa").style.display="block";
}

function copyLink(){navigator.clipboard.writeText(linkBox.value)}
function shareWA(){window.open("https://wa.me/?text="+encodeURIComponent(linkBox.value))}

/* ================= LANDING MODE ================= */
if(landingId){
  const d=JSON.parse(localStorage.getItem("pm_"+landingId));
  if(!d){app.innerHTML="Invalid link";}

  const upiLink=
    `upi://pay?pa=${encodeURIComponent(d.upi)}&pn=${encodeURIComponent(d.title||"PayMoney")}&am=${d.amount}&cu=INR`;

  app.innerHTML=`
    <div class="card">
      <h2>${d.title||"PayMoney"}</h2>
      <div class="poster"><img src="${d.poster}"></div>
      <p>${d.desc||""}</p>

      <button class="pay" onclick="openUPI('${upiLink}')">ðŸ“± Open UPI App</button>
      <button class="qrbtn" onclick="showQR('${upiLink}')">ðŸ’» Scan QR & Pay</button>

      <div class="qr-box" id="qrBox"></div>
      <div class="note">UPI app na khule to QR scan kare</div>
      <div class="footer">Â© 2026 PayMoney â€¢ India</div>
    </div>
  `;
}

/* UPI + QR FALLBACK */
function openUPI(link){
  location.href=link;
  setTimeout(()=>showQR(link),1500);
}
function showQR(link){
  const box=document.getElementById("qrBox");
  box.style.display="block";
  box.innerHTML="";
  QRCode.toCanvas(
    document.createElement("canvas"),
    link,{width:240},
    (e,c)=>box.appendChild(c)
  );
}
</script>

</body>
</html>
