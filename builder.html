<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PayMoney Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:#f1f5f9}

/* Header */
header{
  position:sticky;top:0;z-index:20;
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 22px;background:#fff;border-bottom:1px solid #e5e7eb
}
header h2{margin:0;font-size:18px;display:flex;gap:8px;align-items:center}
header button{
  background:#22c55e;color:#fff;border:none;
  padding:10px 18px;border-radius:999px;
  font-weight:700;cursor:pointer;
  transition:.2s
}
header button:hover{opacity:.9}

/* Layout */
.wrapper{display:flex;gap:22px;padding:22px}
.form,.preview{
  flex:1;background:#fff;border-radius:22px;
  padding:22px;box-shadow:0 20px 40px rgba(0,0,0,.12)
}
@media(max-width:900px){.wrapper{flex-direction:column}}

/* Inputs */
label{font-size:13px;font-weight:700;color:#334155}
input,textarea{
  width:100%;padding:11px;margin:6px 0 14px;
  border-radius:10px;border:1px solid #cbd5e1;
  transition:.2s
}
input:focus,textarea:focus{
  outline:none;border-color:#0ea5e9;
  box-shadow:0 0 0 3px #e0f2fe
}
.radio{display:flex;gap:20px;margin-bottom:14px}

.primary{
  width:100%;padding:14px;border:none;border-radius:999px;
  background:#0ea5e9;color:#fff;font-weight:800;
  cursor:pointer;transition:.25s
}
.primary:hover{transform:translateY(-1px);box-shadow:0 10px 25px rgba(14,165,233,.35)}
.disabled{opacity:.5;pointer-events:none}

/* Preview Card */
.card{
  max-width:420px;margin:auto;background:#fff;padding:18px;
  border-radius:22px;box-shadow:0 20px 40px rgba(0,0,0,.15)
}
.card img{
  width:100%;border-radius:16px;display:none;margin-bottom:10px
}
.badge{
  display:inline-block;padding:4px 12px;border-radius:999px;
  background:#dcfce7;color:#166534;
  font-size:12px;font-weight:800
}
.amount{font-size:22px;font-weight:900;margin:10px 0}
.small{font-size:13px;color:#64748b}
</style>
</head>

<body>

<header>
  <h2><i class="fa-solid fa-bolt"></i> PayMoney Builder</h2>
  <button>Register Now</button>
</header>

<div class="wrapper">

<!-- FORM -->
<div class="form">
  <h3>Create Payment Page</h3>

  <label>Title *</label>
  <input id="title">

  <label>Sub Title</label>
  <input id="subtitle">

  <label>Description</label>
  <textarea id="desc"></textarea>

  <label><i class="fa-regular fa-calendar"></i> Date</label>
  <input type="date" id="date">

  <label><i class="fa-regular fa-clock"></i> Time</label>
  <input type="time" id="time">

  <label>Mode</label>
  <div class="radio">
    <label><input type="radio" name="mode" value="Online" checked> Online</label>
    <label><input type="radio" name="mode" value="Offline"> Offline</label>
  </div>

  <label>Amount (₹) *</label>
  <input type="number" id="amount">

  <label>UPI ID *</label>
  <input id="upi">

  <label>WhatsApp Group Link (optional)</label>
  <input id="waGroup" placeholder="https://chat.whatsapp.com/...">

  <label>Upload Poster *</label>
  <input type="file" id="image" accept="image/*">

  <button class="primary" onclick="generate()">
    <i class="fa-solid fa-link"></i> Generate & Open Page
  </button>
</div>

<!-- PREVIEW -->
<div class="preview">
  <h3>Live Preview</h3>

  <div class="card">
    <img id="pImg">
    <span class="badge" id="pMode">Online</span>
    <h3 id="pTitle">Title</h3>
    <p id="pSub"></p>
    <p id="pDesc" class="small"></p>
    <p id="pDT" class="small"></p>
    <div class="amount" id="pAmount">₹0</div>

    <button class="primary disabled">
      <i class="fa-solid fa-qrcode"></i> Open UPI App
    </button>

    <button id="pGroupBtn"
      class="primary disabled"
      style="background:#25D366;margin-top:8px">
      <i class="fa-brands fa-whatsapp"></i> Access WhatsApp Group
    </button>
  </div>
</div>

</div>

<script>
/* ===== CONFIG ===== */
const CLOUD_NAME="ddusj34vn";
const UPLOAD_PRESET="paymoney_unsigned";

/* ===== STATE ===== */
let imageURL="";

/* ===== ELEMENTS ===== */
const title=gid("title"),
subtitle=gid("subtitle"),
desc=gid("desc"),
date=gid("date"),
time=gid("time"),
amount=gid("amount"),
upi=gid("upi"),
waGroup=gid("waGroup"),
image=gid("image");

const pTitle=gid("pTitle"),
pSub=gid("pSub"),
pDesc=gid("pDesc"),
pDT=gid("pDT"),
pAmount=gid("pAmount"),
pMode=gid("pMode"),
pImg=gid("pImg"),
pGroupBtn=gid("pGroupBtn");

function gid(id){return document.getElementById(id)}

/* ===== PREVIEW ===== */
[title,subtitle,desc,date,time,amount,waGroup].forEach(el=>{
  el.oninput=updatePreview;
});
document.querySelectorAll("input[name=mode]").forEach(r=>{
  r.onchange=updatePreview;
});

function updatePreview(){
  pTitle.innerText=title.value||"Title";
  pSub.innerText=subtitle.value||"";
  pDesc.innerText=desc.value||"";
  pDT.innerText=(date.value||"")+" "+(time.value||"");
  pAmount.innerText="₹ "+(amount.value||0);
  pMode.innerText=document.querySelector("input[name=mode]:checked").value;

  waGroup.value.trim()
    ? pGroupBtn.classList.remove("disabled")
    : pGroupBtn.classList.add("disabled");
}

/* ===== IMAGE UPLOAD ===== */
image.onchange=async()=>{
  const file=image.files[0];
  if(!file) return;

  const fd=new FormData();
  fd.append("file",file);
  fd.append("upload_preset",UPLOAD_PRESET);

  const res=await fetch(
    `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
    {method:"POST",body:fd}
  );
  const data=await res.json();
  imageURL=data.secure_url;

  pImg.src=imageURL;
  pImg.style.display="block";
};

/* ===== SHORT LINK ===== */
function makeId(){
  return Math.random().toString(36).slice(2,8);
}

function generate(){
  if(!title.value||!amount.value||!upi.value||!imageURL){
    alert("Title, Amount, UPI & Image required");
    return;
  }

  const shortId=makeId();

  const payload={
    [shortId]:{
      title:title.value,
      subtitle:subtitle.value,
      desc:desc.value,
      date:date.value,
      time:time.value,
      mode:document.querySelector("input[name=mode]:checked").value,
      amount:amount.value,
      upi:upi.value,
      img:imageURL,
      group:waGroup.value||""
    }
  };

  console.log("ADD THIS TO data/links.json:",payload);
  window.open("/p.html?id="+shortId,"_blank");
}
</script>

</body>
</html>
