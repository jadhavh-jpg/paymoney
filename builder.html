<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PayMoney â€“ Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:#f5f7fb}
.wrap{max-width:1200px;margin:20px auto;padding:0 14px}
.flex{display:flex;gap:20px}
@media(max-width:900px){.flex{flex-direction:column}}
.box{background:#fff;border-radius:18px;padding:20px;width:50%}
@media(max-width:900px){.box{width:100%}}

label{font-weight:600;margin-top:12px;display:block}
input,textarea{width:100%;padding:12px;border-radius:8px;border:1px solid #ccc;margin-top:6px}
textarea{min-height:90px}

button{
  width:100%;padding:14px;border:none;border-radius:14px;
  font-size:16px;font-weight:700;cursor:pointer;margin-top:14px
}
.primary{background:#0D3B66;color:#fff}
.copy{background:#0f172a;color:#fff}
.wa{background:#25D366;color:#fff}

/* PREVIEW */
.preview{text-align:center}
.header{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:10px
}
.logo-left{display:flex;align-items:center;gap:10px}
.logo{width:70px;height:70px;border-radius:12px;background:#eee;overflow:hidden}
.logo img{width:100%;height:100%;object-fit:contain}
.reg-btn{
  padding:10px 18px;border-radius:999px;
  background:#22c55e;color:#fff;text-decoration:none;font-weight:700
}
.poster{aspect-ratio:2/3;background:#ddd;border-radius:14px;overflow:hidden}
.poster img{width:100%;height:100%;object-fit:cover}
.date{margin-top:8px;font-size:14px;color:#555}
.desc{margin:12px 0;color:#333;font-size:14px}
.note{font-size:13px;color:#777}
</style>
</head>

<body>

<div class="wrap">
<div class="flex">

<!-- BUILDER -->
<div class="box">
<h2>Create Payment Landing</h2>

<label>Logo</label>
<input type="file" id="logoInput">

<label>Poster Image</label>
<input type="file" id="posterInput">

<label>Brand Name</label>
<input id="brand">

<label>Date & Time</label>
<input type="datetime-local" id="dt">

<label>UPI ID</label>
<input id="upi">

<label>Amount (INR)</label>
<input id="amount" type="number">

<label>Description</label>
<textarea id="desc"></textarea>

<button class="primary" id="genBtn">Generate Link</button>

<input id="shareLink" readonly style="display:none">
<button class="copy" onclick="copyLink()">ðŸ“‹ Copy Link</button>
<button class="wa" onclick="shareWA()">ðŸ“¤ Share WhatsApp</button>
</div>

<!-- LIVE PREVIEW -->
<div class="box preview">
  <div class="header">
    <div class="logo-left">
      <div class="logo" id="pLogo"></div>
      <strong id="pBrand">Brand</strong>
    </div>
    <a class="reg-btn" id="regBtn">Register Now</a>
  </div>

  <div class="poster" id="pPoster"></div>
  <div class="date" id="pDate"></div>
  <div class="desc" id="pDesc"></div>
  <div class="note">Live preview</div>
</div>

</div>
</div>

<script>
/* ================= FIREBASE SAFE INIT ================= */
let storage = null;

try{
  firebase.initializeApp({
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com"
  });
  storage = firebase.storage();
}catch(e){
  console.warn("Firebase not configured â€“ preview mode active");
}

/* ================= ELEMENTS ================= */
const brand = document.getElementById("brand");
const dt = document.getElementById("dt");
const desc = document.getElementById("desc");
const logoInput = document.getElementById("logoInput");
const posterInput = document.getElementById("posterInput");

const pBrand = document.getElementById("pBrand");
const pDate = document.getElementById("pDate");
const pDesc = document.getElementById("pDesc");
const pLogo = document.getElementById("pLogo");
const pPoster = document.getElementById("pPoster");
const regBtn = document.getElementById("regBtn");

let logoURL = "", posterURL = "";
const pid = Date.now();

/* ================= LIVE TEXT PREVIEW ================= */
brand.oninput = () => pBrand.innerText = brand.value || "Brand";
dt.oninput    = () => pDate.innerText  = dt.value || "";
desc.oninput  = () => pDesc.innerText  = desc.value || "";

/* ================= IMAGE UPLOAD (SAFE) ================= */
function uploadImage(file, cb){
  if(!file) return;

  // ðŸ”¥ Firebase ready nahi â†’ temp preview
  if(!storage){
    const tempURL = URL.createObjectURL(file);
    cb(tempURL);
    return;
  }

  // ðŸ”¥ Firebase ready â†’ permanent
  const ref = storage.ref("landing-images/"+Date.now()+"_"+file.name);
  ref.put(file)
     .then(()=>ref.getDownloadURL())
     .then(cb);
}

logoInput.onchange = e => {
  uploadImage(e.target.files[0], url => {
    logoURL = url;
    pLogo.innerHTML = `<img src="${url}">`;
  });
};

posterInput.onchange = e => {
  uploadImage(e.target.files[0], url => {
    posterURL = url;
    pPoster.innerHTML = `<img src="${url}">`;
  });
};

/* ================= GENERATE LINK ================= */
genBtn.onclick = () => {
  if(!posterURL || !upi.value || !amount.value){
    alert("Poster, UPI & Amount required");
    return;
  }

  const data = {
    brand: brand.value,
    dt: dt.value,
    desc: desc.value,
    upi: upi.value,
    amount: amount.value,
    logo: logoURL,
    poster: posterURL
  };

  localStorage.setItem("pm_"+pid, JSON.stringify(data));

  const link = location.origin + "/landing.html?id=" + pid;
  shareLink.value = link;
  shareLink.style.display = "block";
  regBtn.href = link;
};

/* ================= SHARE ================= */
function copyLink(){
  navigator.clipboard.writeText(shareLink.value);
}
function shareWA(){
  window.open("https://wa.me/?text="+encodeURIComponent(shareLink.value));
}
</script>

</body>
</html>
