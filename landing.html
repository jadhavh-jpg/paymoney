<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pay Now</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta property="og:title" content="Payment Request">
<meta property="og:description" content="Pay securely using UPI">
<meta property="og:type" content="website">

<style>
body{margin:0;background:#f1f5f9;font-family:system-ui}
.card{
  max-width:420px;margin:24px auto;background:#fff;padding:20px;
  border-radius:22px;box-shadow:0 20px 40px rgba(0,0,0,.15)
}
img{width:100%;border-radius:16px;margin-bottom:10px}
.badge{
  display:inline-block;padding:4px 10px;border-radius:999px;
  background:#dcfce7;color:#166534;font-weight:700;font-size:12px
}
.amount{font-size:24px;font-weight:900;margin:12px 0}
.btn{
  width:100%;padding:14px;margin-top:10px;border:none;
  border-radius:999px;font-weight:800;cursor:pointer
}
.pay{background:#22c55e;color:#fff}
.wa{background:#25D366;color:#fff}
.copy{background:#0ea5e9;color:#fff}
.qr{text-align:center;margin-top:14px}
.qr img{width:180px}
.error{text-align:center;padding:40px;font-size:18px}
</style>
</head>

<body>

<div id="app"></div>

<script>
// üîπ Read URL params ONCE
const p = new URLSearchParams(location.search);

const title  = p.get("title");
const amount = p.get("amount");
const upi    = p.get("upi");

// üîπ Validation
if(!title || !amount || !upi){
  document.getElementById("app").innerHTML =
    "<div class='error'>‚ùå Invalid or expired payment link</div>";
  throw new Error("Invalid link");
}

// üîπ Optional params
const desc  = p.get("desc") || "";
const img   = p.get("img") || "";
const mode  = p.get("mode") || "";
const date  = p.get("date") || "";
const time  = p.get("time") || "";
const group = p.get("group"); // üëà WhatsApp Group

// üîπ UPI link
const upiLink =
  `upi://pay?pa=${upi}&am=${amount}&cu=INR&pn=${encodeURIComponent(title)}`;

// üîπ Render HTML ONCE
document.getElementById("app").innerHTML = `
<div class="card">
  ${img ? `<img src="${img}">` : ""}
  ${mode ? `<span class="badge">${mode}</span>` : ""}
  <h2>${title}</h2>
  <p>${desc}</p>
  <p>${date} ${time}</p>
  <div class="amount">‚Çπ ${amount}</div>

  <button class="btn pay" onclick="location.href='${upiLink}'">
    Open UPI App
  </button>

  ${group ? `
  <button id="groupBtn" class="btn wa">
    Access WhatsApp Group
  </button>` : ""}

  <button class="btn wa" onclick="share()">Share on WhatsApp</button>
  <button class="btn copy" onclick="copy()">Copy Link</button>

  <div class="qr">
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(upiLink)}">
    <div>Scan if app doesn‚Äôt open</div>
  </div>
</div>`;

// üîπ Attach group click AFTER render
if(group){
  document.getElementById("groupBtn").onclick = () => {
    window.open(group, "_blank");
  };
}

// üîπ Share & Copy
function share(){
  const msg = `${title}\nAmount: ‚Çπ${amount}\n\nPay here:\n${location.href}`;
  window.open("https://wa.me/?text="+encodeURIComponent(msg));
}
function copy(){
  navigator.clipboard.writeText(location.href);
  alert("Link copied");
}
</script>

</body>
</html>
